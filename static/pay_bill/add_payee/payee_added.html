<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Payee Added</title>
  <link rel="stylesheet" href="../../styles.css">
</head>
<body>
  <nav>
    <h1>My Online Bank</h1>
    <div class="nav-buttons">
      <button onclick="window.location.href='../../index.html'">Accounts</button>
      <button class="active-tab" onclick="window.location.href='../pay_bill.html'">Pay Bills</button>
      <button onclick="window.location.href='../../etransfer/etransfer.html'">e-Transfer</button>
      <button class="nav-btn" id="nav-services" onclick="window.location.href='services.html'">Bank Services</button>
      <button class="nav-btn" id="nav-profile" onclick="window.location.href='profile.html'">Profile & Settings</button>
    </div>
  </nav>

  <div class="content">
    <div class="payee-box">
      <h2>ðŸŽ‰ Payee Successfully Added!</h2>
      <p>Your new payee has been added to your account.</p>

      <div class="account-box" style="text-align: left; display: inline-block; margin-top: 20px;">
        <p><strong>Payee Name:</strong> <span id="payee-name"></span></p>
        <p><strong>Account Number:</strong> <span id="payee-account"></span></p>
      </div>

      <br><br>
      <button class="button button-primary" id="back-pay-bill" onclick="window.location.href='../pay_bill.html'">Back to Pay Bills</button>
    </div>
  </div>

  <!-- <iframe src="../../tutorbot.html" class="chatbot-frame"></iframe> -->
  <iframe src="../../tellerbot.html" class="chatbot-frame"></iframe>

  <script>
    const params = new URLSearchParams(window.location.search);
    document.getElementById("payee-name").textContent = params.get("name") || "[Unknown]";
    document.getElementById("payee-account").textContent = params.get("account") || "[Unknown]";

      let lastHighlightedSelector = null;

  // Take action based on messages from the chatbot
  let assistant = "grace"; // Default assistant

  window.addEventListener("message", (event) => {
    // ðŸ”¹ First handle assistant assignment
    if (event.data?.instruction === "sendAssistant" && event.data.assistant) {
    assistant = event.data.assistant;
    sessionStorage.setItem("assistant", assistant);
    console.log("âœ… Assistant set to:", assistant);
    return;  // âœ… Important: stop further processing for this message
    }

    // Basic guards
    if (!event.data || typeof event.data !== "object") return;
    if (!("instruction" in event.data)) return;

    const { selector, instruction, value } = event.data;
    console.log("Received message from chatbot:", selector, instruction, value);
    if (typeof instruction !== "string") return;

    // ðŸ”™ Handle global navigation actions (no selector required)
    if (instruction === "navigate") {
      if (value === "back") window.history.back();
      else if (value === "forward") window.history.forward();
      else if (value === "reload") window.location.reload();
      return; // nothing else to do
    }

    // For the rest, selector is expected; bail if it's not a string
    if (typeof selector !== "string") return;

    lastHighlightedSelector = selector;
    const elements = document.querySelectorAll(selector);

    if (instruction === "highlight") {
    elements.forEach(el => el.classList.add("highlight"));
    }
    if (instruction === "mark-complete") {
    elements.forEach(el => el.classList.remove("highlight"));
    }
    if (instruction === "fill") {
    elements.forEach(el => {
        if (el.tagName === "INPUT" || el.tagName === "TEXTAREA") {
        el.value = value || "";
        el.dispatchEvent(new Event("input", { bubbles: true }));
        el.dispatchEvent(new Event("change", { bubbles: true }));
        }
    });
    }
    if (instruction === "select") {
      console.log("Selecting element:", elements, value);
      elements.forEach(el => {
          if (el.tagName === "SELECT") {
          el.value = value || "";
          el.dispatchEvent(new Event("change", { bubbles: true }));
          }
      });
    }
    if (instruction === "click") {
        elements.forEach(el => {
        const event = new MouseEvent("click", {
            bubbles: true,
            cancelable: true,
            view: window
        });
        el.dispatchEvent(event);
        });
    }
    if (instruction === "check") {
      elements.forEach(el => {
        if (el.tagName === "INPUT" && el.type === "checkbox") {
          el.checked = true;
          el.dispatchEvent(new Event("input", { bubbles: true }));
          el.dispatchEvent(new Event("change", { bubbles: true }));
        }
      });
    }

    if (instruction === "uncheck") {
      elements.forEach(el => {
        if (el.tagName === "INPUT" && el.type === "checkbox") {
          el.checked = false;
          el.dispatchEvent(new Event("input", { bubbles: true }));
          el.dispatchEvent(new Event("change", { bubbles: true }));
        }
      });
    }

    if (instruction === "submit") {
    elements.forEach(el => {
        if (el.tagName === "FORM") {
        el.submit();
        }
    });
    }
  });

  </script>
</body>
</html>
