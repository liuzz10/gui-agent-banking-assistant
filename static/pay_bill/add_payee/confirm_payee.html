<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Confirm Payee</title>
  <link rel="stylesheet" href="../../styles.css" />
</head>
<body>
  <nav>
    <h1>My Online Bank</h1>
    <div class="nav-buttons">
      <button onclick="window.location.href='../../index.html'">Accounts</button>
      <button onclick="window.location.href='../pay_bill.html'">Pay Bills</button>
      <button onclick="window.location.href='../../etransfer/etransfer.html'">e-Transfer</button>
      <button class="nav-btn" id="nav-services" onclick="window.location.href='services.html'">Bank Services</button>
      <button class="nav-btn" id="nav-profile" onclick="window.location.href='profile.html'">Profile & Settings</button>
    </div>
  </nav>

  <div class="content">
    <h2>Confirm New Payee</h2>

    <div class="account-box">
      <p><strong>Payee Name:</strong> <span id="confirm-name"></span></p>
      <p><strong>Account Number:</strong> <span id="confirm-account"></span></p>

      <div>
        <button class="button" onclick="window.history.back()">Cancel</button>
        <button class="button button-primary" onclick="finalizePayee()">Confirm</button>
      </div>

    </div>
  </div>

  <iframe src="../../tutorbot.html" class="chatbot-frame"></iframe>
  <!-- <iframe src="../../tellerbot.html" class="chatbot-frame"></iframe> -->

<!-- replace your confirm page's script with this -->
<script>
  // Parse query parameters
  const params = new URLSearchParams(window.location.search);
  const name = params.get("name") || "";
  const account = params.get("account") || "";

  document.getElementById("confirm-name").textContent = name;
  document.getElementById("confirm-account").textContent = account;

  async function finalizePayee() {
    const confirmBtn = document.querySelector(".button-primary");
    confirmBtn.disabled = true;
    confirmBtn.textContent = "Saving…";

    try {
      const res = await fetch("/api/add_payee", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, account })
      });

      if (!res.ok) throw new Error(`HTTP ${res.status}`);

      // (optional) notify chatbot
      const bot = document.querySelector("iframe");
      bot?.contentWindow?.postMessage({
        instruction: "log",
        text: `✅ Payee added: ${name} (${account})`
      }, "*");

      // keep passing details to show on the success page
      const query = new URLSearchParams({ name, account }).toString();
      window.location.href = `payee_added.html?${query}`;
    } catch (err) {
      alert("Failed to save payee. Please try again.");
      console.error(err);
      confirmBtn.disabled = false;
      confirmBtn.textContent = "Confirm";
    }
  }
</script>

</body>
</html>
